<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hochzeit Marie und Tobias – Galerie</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            background: #f5f5f5;
            margin: 0;
        }

        h1 {
            text-align: center;
            margin: 25px 10px 10px;
            font-size: 1.4rem;
        }

        .pw-box {
            max-width: 360px;
            margin: 40px auto;
            background: #fff;
            padding: 22px 24px 20px;
            border-radius: 12px;
            box-shadow: 0 12px 26px rgba(0,0,0,0.1);
        }

        .pw-box p {
            font-size: 0.9rem;
            margin-bottom: 12px;
        }

        .pw-row {
            display: flex;
            gap: 8px;
        }

        .pw-row input {
            flex: 1;
            padding: 9px;
            font-size: 1rem;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .pw-row button {
            padding: 9px 16px;
            background: #111827;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .pw-error {
            margin-top: 8px;
            font-size: 0.8rem;
            color: #b91c1c;
            min-height: 1.2em;
        }

        .gallery-box {
            display: none;
            max-width: 1200px;
            margin: 0 auto 40px;
            padding: 12px;
        }

        .gallery-header {
            display: flex;
            justify-content: space-between;
            margin: 12px 4px;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 8px;
        }

        .gallery img {
            width: 100%;
            border-radius: 8px;
            cursor: pointer;
            object-fit: cover;
            aspect-ratio: 3 / 2;
        }

        .lightbox {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        .lightbox img {
            max-width: 94vw;
            max-height: 94vh;
            border-radius: 10px;
        }
    </style>
</head>
<body>

<h1>Hochzeit Marie und Tobias – Bildgalerie</h1>

<!-- Passwortbox -->
<div class="pw-box" id="pw-box">
    <p>Bitte gib das Kennwort ein, um die Bilder zu sehen.</p>
    <p style="font-size:0.8rem; opacity:0.7;">Hinweis: Datum der Hochzeit (TT.MM.JJJJ)</p>

    <div class="pw-row">
        <input id="pw-input" type="password" placeholder="Kennwort">
        <button id="pw-btn">Öffnen</button>
    </div>
    <div class="pw-error" id="pw-error"></div>
</div>

<!-- Galerie -->
<div class="gallery-box" id="gallery-box">
    <div class="gallery-header">
        <div><strong>Alle Bilder</strong></div>
        <div id="gallery-count" style="opacity:0.7; font-size:0.85rem;"></div>
    </div>
    <div class="gallery" id="gallery"></div>
</div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
    <img id="lightbox-img" src="">
</div>

<script>
    // Passwort
    const GALLERY_PASSWORD = "18.10.2025";

    const pwBox = document.getElementById("pw-box");
    const pwInput = document.getElementById("pw-input");
    const pwBtn = document.getElementById("pw-btn");
    const pwError = document.getElementById("pw-error");
    const galleryBox = document.getElementById("gallery-box");

    function checkPassword() {
        if (pwInput.value.trim() === GALLERY_PASSWORD) {
            pwBox.style.display = "none";
            galleryBox.style.display = "block";
            loadImages();
        } else {
            pwError.textContent = "Kennwort falsch.";
        }
    }

    pwBtn.addEventListener("click", checkPassword);
    pwInput.addEventListener("keydown", e => {
        if (e.key === "Enter") checkPassword();
    });

    // Dein OneDrive-Ordner-Link – bereits eingetragen
    const onedriveFolderUrl =
        "https://1drv.ms/f/c/025af440ecb1be2e/IgBDzBFjfhouQ5M0ubighAxkAe3fjEFIsXFR_EvGHRXW3QU?e=5bMDBV";

    function encodeBase64(str) {
        return btoa(str).replace(/=/g, "");
    }

    function getApiUrl(folderUrl) {
        return "https://api.onedrive.com/v1.0/shares/"
            + encodeBase64(folderUrl)
            + "/root?expand=children";
    }

    // Bilder laden
    async function loadImages() {
        try {
            const apiUrl = getApiUrl(onedriveFolderUrl);
            const res = await fetch(apiUrl);
            const data = await res.json();

            const gallery = document.getElementById("gallery");
            const galleryCount = document.getElementById("gallery-count");
            gallery.innerHTML = "";

            const files = (data.children || []).filter(item =>
                item.file && item.file.mimeType && item.file.mimeType.startsWith("image")
            );

            files.forEach(item => {
                const img = document.createElement("img");
                img.src = item["@content.downloadUrl"];
                img.addEventListener("click", () => openLightbox(img.src));
                gallery.appendChild(img);
            });

            galleryCount.textContent = files.length + " Bilder";
        } catch (e) {
            console.error(e);
        }
    }

    // Lightbox
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightbox-img");

    function openLightbox(src) {
        lightboxImg.src = src;
        lightbox.style.display = "flex";
    }

    lightbox.addEventListener("click", () => {
        lightbox.style.display = "none";
    });
</script>

</body>
</html>
